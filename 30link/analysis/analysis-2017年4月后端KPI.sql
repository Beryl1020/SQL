SELECT sum(CASE WHEN inorout = 'A'
  THEN inoutmoney
           WHEN inorout = 'B'
             THEN inoutmoney * (-1) END)
FROM
  silver_njs.history_transfer@silver_std
WHERE fdate BETWEEN 20170408 AND 20170414 AND partnerid = 'pmec'

SELECT *
FROM silver_njs.history_transfer@silver_std

select * from info_silver.pmec_hold_position_order where loginaccount= 163000000139613

select * from info_silver.ods_order_silver where firmid= 163000000139613



select BIrth_day from info_silver.dw_user_account where user_id=167009499
select * from info_silver.tb_crm_user where fa_id=3061917





SELECT
  a.user_id,
  a.submit_time,
  a.bgroup_id,
  a.bia_id,
  a.bname,
  a.firm_id,
  sum(b.contqty)
FROM info_silver.ods_crm_transfer_record a
  JOIN info_silver.ods_history_deal b
    ON a.firm_id = b.firmid
WHERE a.process IN (5, 6) AND a.valid = 1 AND a.bgroup_id IS NOT NULL
      AND a.submit_time < b.trade_time
      AND b.fdate BETWEEN '20170101' AND '20170131'
GROUP BY a.user_id, a.submit_time, a.bgroup_id, a.bia_id, a.bname, a.firm_id;

SELECT DISTINCT
  bia_id,
  bname,
  bgroup_id
FROM info_silver.ods_crm_transfer_record
WHERE bgroup_id IN (1, 7, 8, 111) AND process IN (5, 6) AND to_char(submit_time, 'yyyymm') = 201701


select * from info_silver.ods_crm_transfer_record where bia_id=

select * from silver_consult.tb_crm_dispatch_his@consul_std where user_id=1000058816



/*未在CRM系统里，净入金最大值超过50000的用户交易额总*/
SELECT
  f.firmid,f.partnerid,f.maxmoney,sum(g.contqty)
FROM
  (SELECT
     c.firmid,c.partnerid,max(c.allmoney) AS maxmoney,d.submit_time, e.fa_id
   FROM
     (
       SELECT
         a.firmid,a.realdate,a.partnerid,sum(b.money) AS allmoney
       FROM silver_njs.history_transfer@silver_std a
         JOIN
         (
           SELECT
             firmid,realdate,partnerid,
             CASE WHEN inorout = 'A'
               THEN inoutmoney
             WHEN inorout = 'B'
               THEN inoutmoney * (-1) END AS money
           FROM silver_njs.history_transfer@silver_std
         ) b
           ON a.firmid = b.firmid
       WHERE a.realdate >= b.realdate
       GROUP BY a.firmid, a.realdate, a.partnerid
     ) c
     LEFT JOIN info_silver.ods_crm_transfer_record d
       ON c.firmid = d.firm_id
     LEFT JOIN (SELECT
                  a1.firm_id,
                  a1.partner_id,
                  a2.fa_id
                FROM tb_silver_user_stat@silver_std a1 JOIN info_silver.tb_crm_user a2 ON a1.user_id = a2.fa_id) e
       ON c.firmid = e.firm_id AND c.partnerid = e.partner_id
   WHERE c.allmoney >= 50000
   GROUP BY c.firmid, c.partnerid, d.submit_time, e.fa_id) f
  JOIN info_silver.ods_history_deal g
    ON f.firmid = g.firmid
WHERE f.submit_time IS NULL AND f.fa_id IS NULL
GROUP BY f.firmid, f.partnerid, f.maxmoney




select firmid,sum(case when fdate between 20160901 and 20160931 then contqty end) as sep,
  sum(case when fdate between 20161001 and 20161031 then contqty end) as oct,
   sum(case when fdate between 20161101 and 20161131 then contqty end) as nov,
   sum(case when fdate between 20161201 and 20161231 then contqty end) as dec,
   sum(case when fdate between 20170101 and 20170131then contqty end) as jan,
   sum(case when fdate between 20170201 and 20170231 then contqty end) as feb,
   sum(case when fdate between 20170301 and 20170331 then contqty end) as mar
from info_silver.ods_history_deal
where firmid IN
      ('19848227', '163000000026194', '163000000034433', '163000000035890', '163000000034011', '1078581819', '163000000036323', '163000000039099', '15835816', '163000000015558', '12618631', '163000000045992', '15890857', '163000000068280', '29943475', '16366319', '163000000094604', '18925530', '163000000102171', '163000000119161', '18852269', '31852020', '163000000160620', '163000000184813', '163000000035809', '18877516', '16332406', '12683185', '12683193', '16346214', '1079245727', '19889538', '16389343', '19861866', '18979830', '18917070', '15803380', '15826897', '11873939', '15869038', '18910919', '18821153', '18812202', '18864555', '18870037', '18804682', '16619337', '15858607', '16362169', '16330334', '16368594', '15815674', '18942996', '16335666', '16617298', '11856970', '11812721', '18860320', '18854985', '19864011', '18981445', '12678080', '18801025', '12676163', '12658801', '19867659', '19860901', '15899108', '12685458', '18954714', '15890548', '18847589', '18883522', '18888935', '18905071', '16367536', '1085715973', '12665761', '1086934742', '1087406848', '1087353737', '18898667', '18870768', '16317415', '16377046', '15837518', '29811146', '1083803137', '163000000003428', '28852106', '16331727', '15824309', '18916773', '18889144', '163000000006677', '163000000001014', '163000000007434', '1083294344', '163000000013994', '163000000014024', '163000000002071', '163000000015204', '163000000015022', '18915509', '1089142500', '19852031', '163000000011399', '29899437', '163000000017239', '1086302370', '15831112', '163000000022367', '12670796', '163000000030589', '25814517', '25872129', '163000000050032', '163000000059309', '163000000061161', '163000000058813', '11820478', '163000000128950', '163000000176690', '36627742', '163000000205202', '1082609635', '18907114', '16602573', '16611641', '19871730', '19819127', '1084622429', '15828500', '11806630', '12693609', '15896277', '12677704', '18810973', '18822795', '18844420', '18886638', '15837787', '18837694', '11899438', '18806486', '16666827', '16326264', '18927163', '16331375', '18924040', '18901872', '11817840', '11815919', '16336926', '16336606', '11830911', '15895031', '16610165', '18920442', '15889063', '18835698', '19829019', '18949910', '12653259', '18955846', '18836905', '12687797', '18867771', '16396771', '19891136', '18918304', '19805343', '19869633', '16650276', '1079046030', '18840390', '16349204', '18861790', '1078986335', '18809445', '18810538', '19895839', '18949420', '12613342', '1078500854', '1081017075', '18940972', '12623300', '12694464', '16396319', '16366362', '19876193', '12641409', '11810023', '18832696', '19891421', '18907777', '12652918', '16343318', '28835582', '1087884624', '163000000002349', '163000000001703', '1081234256', '1087576172', '12672133', '163000000002141', '29815310', '16354619', '16379156', '163000000006589', '163000000001890', '163000000002305', '163000000004393', '163000000005007', '163000000008124', '163000000008967', '163000000012572', '163000000007188', '163000000005140', '163000000014337', '163000000014934', '163000000005088', '163000000012121', '163000000011493', '163000000006531', '163000000019409', '16300849', '163000000020540', '163000000012941', '18896210', '163000000027940', '12681850', '12638324', '16337497', '25845529', '163000000033999', '19813706', '163000000035806', '163000000037308', '163000000037629', '16321963', '1078125947', '11846620', '163000000049916', '163000000054491', '1081056045', '163000000058033', '163000000067919', '163000000070756', '163000000061232', '163000000090258', '29967825', '163000000073236', '18941229', '163000000168631', '163000000176907', '36606563', '163000000250991', '163000000354231', '1084167658', '16373153', '18809234', '16622415', '19830650', '18931148', '18966431', '19813878', '15884700', '11848049', '11806758', '15808546', '18865922', '12624276', '18879013', '18837378', '12664284', '18834253', '16363662', '18811774', '15864398', '11891169', '12637219', '19831522', '15841044', '15883342', '16605190', '15821602', '19932969', '19853770', '19829687', '19888081', '15815571', '16371544', '16371320', '16364602', '19891210', '19894867', '12642246', '19855107', '15805966', '18896150', '16341076', '19827981', '18869334', '18838358', '18882021', '12641965', '12684798', '16324563', '18801140', '18804339', '18847872', '19866445', '18821964', '16323274', '18819184', '18984720', '18980172', '12605717', '19814924', '18926020', '16340728', '19863432', '11808851', '1087584081', '16337443', '18980831', '15847484', '18851916', '18872351', '11839364', '16341894', '18812513', '12647097', '19866203', '18834870', '12663588', '1087904593', '15836505', '16303888', '16356009', '16368098', '18806965', '163000000001734', '163000000002037', '18935529', '16375394', '28903974', '163000000000585', '163000000009147', '163000000007914', '163000000013168', '163000000002087', '163000000012074', '163000000014451', '163000000010971', '18826677', '163000000001520', '163000000005063', '1088169306', '163000000019018', '163000000013722', '163000000025038', '163000000020120', '163000000013045', '163000000031579', '19806008', '18842228', '163000000039668', '163000000042284', '163000000050559', '163000000016574', '18885643', '163000000016734', '26631242', '163000000036649', '163000000096697', '163000000129206', '163000000125968', '12661483', '163000000184617', '163000000199012', '163000000073733', '163000000226800', '163000000232968', '16367607', '163000000177028', '163000000344445', '12627625', '16366566', '16394057', '19815292', '18959746', '11807254', '15801540', '15894356', '18887321', '18839244', '18872047', '18879330', '15812548', '18818113', '12667553', '16363782', '18831803', '16388221', '18895163', '18971885', '18821551', '15882888', '12643239', '18901463', '18861587', '15869911', '18912724', '12670345', '11834449', '12682386', '16635153', '15843643', '15801954', '18845083', '1080129865', '1084207811', '1083237992', '19847013', '18876416', '11855460', '16365776', '16336452', '19891606', '12682068', '18896577', '16372256', '19837648', '16603246', '18812307', '12686200', '18866702', '12629699', '18901919', '18956800', '1085077277', '19807990', '18858121', '18818206', '19837736', '12641364', '18857521', '16392977', '18839326', '11818491', '16329165', '12679190', '18993008', '12636876', '12673932', '16328522', '16348954', '18813008', '163000000000800', '18872241', '28868030', '18820296', '16395629', '16303622', '19836360', '18964911', '18828686', '18860144', '163000000001918', '163000000006255', '163000000008369', '163000000000637', '163000000004899', '18941567', '163000000003459', '163000000005421', '163000000013937', '163000000009854', '163000000012817', '163000000004913', '1089306704', '1089367497', '163000000016962', '12610218', '163000000020694', '163000000022460', '163000000021183', '163000000008182', '163000000025558', '163000000026274', '163000000015989', '163000000012058', '163000000026620', '25814189', '163000000032853', '163000000008132', '163000000004099', '163000000037247', '163000000005998', '163000000054838', '163000000055508', '1079371772', '26663772', '163000000064478', '163000000070880', '18843612', '12697937', '163000000095142', '31807158', '163000000010848', '163000000150581', '163000000147468', '163000000154955', '163000000213780', '163000000067521', '163000000338057', '163000000391477', '163000000428598', '18815295'
      )
group by firmid



select * from silver_njs.history_transfer@silver_std where firmid=163000000138238
select * from silver_consult.tb_crm_dispatch_his@consul_std where faid=253963402
 SELECT * FROM tb_silver_user_stat@silver_std where firm_id=163000000138238
SELECT * FROM info_silver.tb_crm_user where fa_id=167009499
select * from info_silver.ods_crm_transfer_record where firm_id=163000000105222
select * from info_silver.ods_history_user where user_id=256426643
select * from info_silver.dw_user_account where firm_id='163000000138238';

select * from info_silver.ods_history_deal where firmid=1087036724






select sum(trans.pmec_net_value_sub+trans.pmec_net_in_sub) as 激活资金,
  count(distinct trans.firm_id) as 流转单数
from info_silver.ods_crm_transfer_record trans
where to_char(trans.submit_time,'yyyymmdd') between 20170101 and 20170131
and trans.process in(5,6) and trans.valid=1 and fgroup_id in (106,111,112,113)


select sum(trans.pmec_net_value_sub+trans.pmec_net_in_sub) as 激活资金,
  count(distinct trans.firm_id) as 流转单数
from info_silver.ods_crm_transfer_record trans
where to_char(trans.submit_time,'yyyymmdd') between 20171201 and 20170131
and trans.process in(5,6) and trans.valid=1 and fgroup_id not in (106,111,112,113)




select b.firmid,b.hdate,b.net_assets,sum(c.contqty) jye from
(
select a.* from
(select firmid,hdate,net_assets,row_number() over (partition by firmid order by net_assets desc) rn from
(select firmid,hdate,net_assets from silver_njs.tb_silver_data_center@silver_std
where net_assets>=10000 and substr(hdate,1,6)='201702' and partner_id='pmec')
) a
where rn=1 and a.firmid in (select firm_id from info_silver.ods_history_user where crm_user_id is null)
) b
join info_silver.ods_history_deal c on b.firmid=c.firmid
where trunc(c.trade_time) between to_date(hdate,'yyyymmdd') and to_date(hdate,'yyyymmdd')+30
group by b.firmid,b.hdate,b.net_assets



